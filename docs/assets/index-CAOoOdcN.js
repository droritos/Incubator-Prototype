(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&e(n)}).observe(document,{childList:!0,subtree:!0});function s(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function e(i){if(i.ep)return;i.ep=!0;const a=s(i);fetch(i.href,a)}})();const k="modulepreload",T=function(h){return"/Incubator-Prototype/"+h},w={},g=function(t,s,e){let i=Promise.resolve();if(s&&s.length>0){let n=function(r){return Promise.all(r.map(d=>Promise.resolve(d).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=n(s.map(r=>{if(r=T(r),r in w)return;w[r]=!0;const d=r.endsWith(".css"),p=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${p}`))return;const c=document.createElement("link");if(c.rel=d?"stylesheet":k,d||(c.as="script"),c.crossOrigin="",c.href=r,l&&c.setAttribute("nonce",l),document.head.appendChild(c),d)return new Promise((u,f)=>{c.addEventListener("load",u),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${r}`)))})}))}function a(n){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=n,window.dispatchEvent(o),!o.defaultPrevented)throw n}return i.then(n=>{for(const o of n||[])o.status==="rejected"&&a(o.reason);return t().catch(a)})};function v(h,t,s,e,i,a){const o=_(a,-20);h.fillStyle=o,h.beginPath(),h.moveTo(t+e/2,s-i),h.lineTo(t+e/2+10,s-i+10),h.lineTo(t+e/2+10,s+10),h.lineTo(t+e/2,s),h.fill(),h.beginPath(),h.moveTo(t-e/2,s),h.lineTo(t-e/2+10,s+10),h.lineTo(t+e/2+10,s+10),h.lineTo(t+e/2,s),h.fill(),h.fillStyle=a,h.fillRect(t-e/2,s-i,e,i)}function m(h,t,s,e,i,a,n=0,o=1,l=1,r=1,d=null){t&&(h.save(),h.globalAlpha=r,h.translate(s,e),h.rotate(n),h.scale(o,l),h.drawImage(t,-i/2,-a/2,i,a),d&&(h.globalCompositeOperation="source-atop",h.fillStyle=d,h.fillRect(-i/2,-a/2,i,a)),h.restore())}function _(h,t){let s=parseInt(h.substring(1,3),16),e=parseInt(h.substring(3,5),16),i=parseInt(h.substring(5,7),16);return s=parseInt(s*(100+t)/100),e=parseInt(e*(100+t)/100),i=parseInt(i*(100+t)/100),s=s<255?s:255,e=e<255?e:255,i=i<255?i:255,s=Math.round(s),e=Math.round(e),i=Math.round(i),"#"+(16777216+(Math.round(s)*65536+Math.round(e)*256+Math.round(i))).toString(16).slice(1)}function E(h){const t=document.createElement("canvas");t.width=h.width,t.height=h.height;const s=t.getContext("2d");s.drawImage(h,0,0);const e=s.getImageData(0,0,t.width,t.height),i=e.data;for(let n=0;n<i.length;n+=4){const o=i[n],l=i[n+1],r=i[n+2];o>230&&l>230&&r>230&&(i[n+3]=0)}s.putImageData(e,0,0);const a=new Image;return a.src=t.toDataURL(),a}function y(h,t,s,e,i,a){if(i>=a)return;const n=e,o=5,l=Math.max(0,i/a);h.fillStyle="#333",h.fillRect(t-n/2,s-e/2-10,n,o),h.fillStyle=l>.5?"#00ff00":l>.25?"#ffff00":"#ff0000",h.fillRect(t-n/2,s-e/2-10,n*l,o)}const x=Object.freeze(Object.defineProperty({__proto__:null,createTransparentSprite:E,drawBlockyRect:v,drawHealthBar:y,drawSprite:m,shadeColor:_},Symbol.toStringTag,{value:"Module"}));class P{constructor(t){this.game=t,this.x=t.canvas.width/2,this.y=t.canvas.height/2,this.width=64,this.height=64,this.speed=t.stats.speed,this.color="#ff4d4d",this.swingTimer=0,this.swingCooldown=Math.max(.05,t.stats.swingCooldown),this.isSwinging=!1,this.swingDuration=.2,this.swordAngle=0,this.swingDirection=1,this.facingX=1}update(t){const s=this.game.input.mouse.x,e=this.game.input.mouse.y,i=s-this.x,a=e-this.y,n=Math.sqrt(i*i+a*a);let o=9999,l=null;if(this.game.entities.forEach(p=>{if(p.hp>0&&!p.markedForDeletion){const c=p.x-this.x,u=p.y-this.y,f=Math.sqrt(c*c+u*u);f<o&&f<400&&(o=f,l=p)}}),l){const p=l.x-this.x,c=l.y-this.y;let f=Math.atan2(c,p)-this.swordAngle;for(;f>Math.PI;)f-=Math.PI*2;for(;f<-Math.PI;)f+=Math.PI*2;this.swordAngle+=f*10*t}else if(n>10){let c=Math.atan2(a,i)-this.swordAngle;for(;c>Math.PI;)c-=Math.PI*2;for(;c<-Math.PI;)c+=Math.PI*2;this.swordAngle+=c*10*t}let r=0,d=0;n>10&&(r=i/n,d=a/n,r>0&&(this.facingX=1),r<0&&(this.facingX=-1),this.x+=r*this.speed*t,this.y+=d*this.speed*t),this.x=Math.max(0,Math.min(this.game.canvas.width,this.x)),this.y=Math.max(0,Math.min(this.game.canvas.height,this.y)),this.swingCooldown=Math.max(.05,this.game.stats.swingCooldown),this.isSwinging?(this.swingTimer+=t,this.swingTimer>=this.swingDuration?(this.isSwinging=!1,this.swingTimer=0):this.checkCollisions()):(this.swingTimer+=t,this.swingTimer>=this.swingCooldown&&this.startSwing())}startSwing(){this.isSwinging=!0,this.swingTimer=0,this.swingDirection*=-1}checkCollisions(){const t=50+this.game.stats.range,s=Math.PI/3+this.game.stats.arc*Math.PI/180;this.game.entities.forEach(e=>{const i=e.x-this.x,a=e.y-this.y;if(Math.sqrt(i*i+a*a)<t){let l=Math.atan2(a,i)-this.swordAngle;for(;l>Math.PI;)l-=Math.PI*2;for(;l<-Math.PI;)l+=Math.PI*2;if(Math.abs(l)<s/2){if(e.type==="Chest")e.hp>0&&!e.invulnerable&&(e.takeDamage(this.game.stats.damage),g(async()=>{const{FloatingText:r}=await import("./FloatingText-DIuYMBHa.js");return{FloatingText:r}},[]).then(({FloatingText:r})=>{this.game.texts.push(new r(this.game.stats.damage,e.x,e.y-20,"#fff",20))}),e.invulnerable=!0,setTimeout(()=>e.invulnerable=!1,200));else if(e.type==="Rock")this.game.input.rockHitCooldown||(this.game.energy-=10,this.game.shake=10,g(async()=>{const{spawnParticles:r}=await import("./Particle-Bl0AywMg.js");return{spawnParticles:r}},[]).then(({spawnParticles:r})=>{r(this.game,e.x,e.y,"#ffffff",5,"spark")}),g(async()=>{const{FloatingText:r}=await import("./FloatingText-DIuYMBHa.js");return{FloatingText:r}},[]).then(({FloatingText:r})=>{this.game.texts.push(new r("-10 Energy",this.x,this.y-40,"#ff4d4d",16))}),this.game.input.rockHitCooldown=!0,setTimeout(()=>this.game.input.rockHitCooldown=!1,500));else if(e.type==="Crab"){if(e.hp>0&&!e.invulnerable){const r=this.game.stats.damage;e.takeDamage(r),g(async()=>{const{FloatingText:d}=await import("./FloatingText-DIuYMBHa.js");return{FloatingText:d}},[]).then(({FloatingText:d})=>{this.game.texts.push(new d(r,e.x,e.y-20,"#fff",20))}),e.invulnerable=!0,setTimeout(()=>e.invulnerable=!1,250)}}else if(e.type==="Pirate"&&e.hp>0&&!e.invulnerable){const r=this.game.stats.damage;e.takeDamage(r),g(async()=>{const{FloatingText:d}=await import("./FloatingText-DIuYMBHa.js");return{FloatingText:d}},[]).then(({FloatingText:d})=>{this.game.texts.push(new d(r,e.x,e.y-40,"#ff0000",20))}),e.invulnerable=!0,setTimeout(()=>e.invulnerable=!1,250)}}}})}draw(t){t.fillStyle="rgba(0,0,0,0.2)",t.beginPath(),t.ellipse(this.x,this.y,this.width/2,12,0,0,Math.PI*2),t.fill();const s=50+this.game.stats.range,e=Math.PI/3+this.game.stats.arc*Math.PI/180;t.save(),t.translate(this.x,this.y),t.beginPath(),t.moveTo(0,0),t.arc(0,0,s,this.swordAngle-e/2,this.swordAngle+e/2),t.fillStyle="rgba(255, 255, 255, 0.15)",t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.4)",t.lineWidth=1,t.stroke(),t.restore(),this.game.assets&&this.game.assets.player?m(t,this.game.assets.player,this.x,this.y,this.width,this.height,0,this.facingX):v(t,this.x,this.y,30,50,this.color),t.save(),t.translate(this.x,this.y);let i=this.swordAngle;if(this.isSwinging){const a=this.swingTimer/this.swingDuration;let n=-e/2,o=e/2;this.swingDirection===-1&&(n=e/2,o=-e/2);const l=n+(o-n)*a;i+=l}else i+=e/2*this.swingDirection;if(t.rotate(i),t.translate(20,0),t.fillStyle="#C0C0C0",t.shadowColor="#fff",t.shadowBlur=5,t.fillRect(0,-2,s-20,6),t.shadowBlur=0,t.fillStyle="#654321",t.fillRect(-5,-3,15,6),t.fillStyle="#ffd700",t.fillRect(-5,-6,4,12),this.isSwinging){const a=this.swingTimer/this.swingDuration;t.beginPath(),this.swingDirection===1?-e/2:e/2,this.swingDirection===1?-e/2+e*a:e/2-e*a,t.moveTo(-20,0),t.lineTo(s-20,0),t.strokeStyle=`rgba(255, 255, 255, ${.8-a})`,t.lineWidth=4,t.stroke()}t.restore()}}class b{constructor(t,s){this.game=t,this.type=s,this.x=t.player.x,this.y=t.player.y,this.width=40,this.height=40,this.target=null,this.state="idle",this.timer=0,this.type==="carrot"?(this.damage=25,this.speed=150,this.range=30,this.attackCooldown=1):(this.damage=40,this.speed=200,this.range=250,this.attackCooldown=.8,this.facingX=1),this.cooldownTimer=0}upgrade(){this.type="parrot",this.damage=40,this.speed=200,this.range=250,this.attackCooldown=.8,g(async()=>{const{spawnParticles:t}=await import("./Particle-Bl0AywMg.js");return{spawnParticles:t}},[]).then(({spawnParticles:t})=>{t(this.game,this.x,this.y,"#00ffcc",20,"burst")})}update(t){if(this.cooldownTimer-=t,(!this.target||this.target.markedForDeletion||this.target.hp<=0)&&(this.target=this.findNearestEnemy(),!this.target)){this.moveTo(this.game.player.x,this.game.player.y-50,t);return}const s=this.target.x-this.x,e=this.target.y-this.y,i=Math.sqrt(s*s+e*e);s>0&&(this.facingX=1),s<0&&(this.facingX=-1),i<=this.range?this.cooldownTimer<=0&&(this.attack(this.target),this.cooldownTimer=this.attackCooldown):(this.moveTo(this.target.x,this.target.y,t),this.type==="carrot"&&(this.timer+=t*10,this.y+=Math.sin(this.timer)*.5))}moveTo(t,s,e){const i=t-this.x,a=s-this.y,n=Math.sqrt(i*i+a*a);n>5&&(this.x+=i/n*this.speed*e,this.y+=a/n*this.speed*e)}findNearestEnemy(){let t=null,s=9999;return this.game.entities.forEach(e=>{if((e.type==="Chest"||e.type==="Crab"||e.type==="Rock")&&e.hp>0){const i=Math.hypot(e.x-this.x,e.y-this.y);i<s&&(s=i,t=e)}}),t}attack(t){if(this.type==="carrot"){t.takeDamage(this.damage);const s=t.x-this.x,e=t.y-this.y;this.x+=s*.2,this.y+=e*.2,g(async()=>{const{FloatingText:i}=await import("./FloatingText-DIuYMBHa.js");return{FloatingText:i}},[]).then(({FloatingText:i})=>{this.game.texts.push(new i(this.damage,t.x,t.y-20,"#ffa500",16))})}else t.takeDamage(this.damage),g(async()=>{const{spawnParticles:s}=await import("./Particle-Bl0AywMg.js");return{spawnParticles:s}},[]).then(({spawnParticles:s})=>{s(this.game,t.x,t.y,"#ff0000",3,"spark")}),g(async()=>{const{FloatingText:s}=await import("./FloatingText-DIuYMBHa.js");return{FloatingText:s}},[]).then(({FloatingText:s})=>{this.game.texts.push(new s(this.damage,t.x,t.y-20,"#00ccff",18))})}draw(t){t.fillStyle="rgba(0,0,0,0.2)",t.beginPath(),t.ellipse(this.x,this.y+this.height/2-5,10,5,0,0,Math.PI*2),t.fill();let s=this.type==="carrot"?this.game.assets.carrot:this.game.assets.parrot;if(s){let e=0;this.type==="parrot"&&(e=Math.sin(Date.now()/200)*10-20),m(t,s,this.x,this.y+e,this.width,this.height,0,this.facingX||1)}else t.fillStyle=this.type==="carrot"?"orange":"red",t.fillRect(this.x-10,this.y-20,20,40)}}class D{constructor(t,s,e){this.game=t,this.tx=s,this.ty=e,this.x=s,this.y=e-600,this.speed=400,this.radius=20,this.damage=100,this.markedForDeletion=!1,this.shadowScale=0}update(t){this.y+=this.speed*t;const s=this.ty-this.y;this.shadowScale=Math.max(0,1-s/600),this.y>=this.ty&&this.explode()}explode(){this.markedForDeletion=!0,this.game.shake=15,g(async()=>{const{spawnParticles:s}=await import("./Particle-Bl0AywMg.js");return{spawnParticles:s}},[]).then(({spawnParticles:s})=>{s(this.game,this.tx,this.ty,"#ff4400",15,"burst"),s(this.game,this.tx,this.ty,"#555555",10,"smoke")});const t=100;this.game.entities.forEach(s=>{const e=s.x-this.tx,i=s.y-this.ty;Math.sqrt(e*e+i*i)<t&&s.takeDamage&&(s.takeDamage(this.damage),g(async()=>{const{FloatingText:n}=await import("./FloatingText-DIuYMBHa.js");return{FloatingText:n}},[]).then(({FloatingText:n})=>{this.game.texts.push(new n(this.damage,s.x,s.y-30,"#ff4400",25))}))})}draw(t){t.save(),t.translate(this.tx,this.ty),t.scale(this.shadowScale,this.shadowScale),t.fillStyle="rgba(0,0,0,0.3)",t.beginPath(),t.ellipse(0,0,20,10,0,0,Math.PI*2),t.fill(),t.restore(),this.game.assets.cannonball?m(t,this.game.assets.cannonball,this.x,this.y,40,40,0):(t.fillStyle="#111",t.beginPath(),t.arc(this.x,this.y,this.radius,0,Math.PI*2),t.fill())}}class I{constructor(t,s,e){this.game=t,this.x=s,this.y=e,this.width=50,this.height=50,this.type="Pirate",this.markedForDeletion=!1,this.maxHp=250,this.hp=this.maxHp,this.speed=80,this.dirX=Math.random()>.5?1:-1,this.dirY=Math.random()>.5?1:-1,this.changeDirTimer=0,this.invulnerable=!1}takeDamage(t){this.hp-=t,this.hp<=0&&(this.markedForDeletion=!0,this.game.gold+=50,g(async()=>{const{FloatingText:s}=await import("./FloatingText-DIuYMBHa.js");return{FloatingText:s}},[]).then(({FloatingText:s})=>{this.game.texts.push(new s("+50G",this.x,this.y,"#ffd700",20))}))}update(t){const s=this.game.player.x-this.x,e=this.game.player.y-this.y,i=Math.sqrt(s*s+e*e);i<400?(this.dirX=s>0?1:-1,this.dirY=e>0?1:-1,this.x+=s/i*this.speed*t,this.y+=e/i*this.speed*t):(this.changeDirTimer+=t,this.changeDirTimer>2&&(this.changeDirTimer=0,this.dirX=Math.random()>.5?1:-1,this.dirY=Math.random()>.5?1:-1),this.x+=this.dirX*(this.speed*.5)*t,this.y+=this.dirY*(this.speed*.5)*t),this.x<0&&(this.x=0),this.x>this.game.canvas.width&&(this.x=this.game.canvas.width),this.y<0&&(this.y=0),this.y>this.game.canvas.height&&(this.y=this.game.canvas.height),i<40&&(this.game.energy-=35*t),this.flashTimer>0&&(this.flashTimer-=t),this.scaleY<1&&(this.scaleY+=t*5,this.scaleY>1&&(this.scaleY=1))}draw(t){let s=this.dirX;const e=this.flashTimer>0?"#ff0000":null;m(t,this.game.assets.pirate,this.x,this.y,this.width,this.height,0,s,this.scaleY,1,e),y(t,this.x,this.y,this.width,this.hp,this.maxHp)}}class S{constructor(t){this.game=t,this.hud=document.getElementById("hud"),this.startScreen=document.getElementById("start-screen"),this.shopOverlay=document.getElementById("shop-overlay"),this.goldDisplay=document.getElementById("gold-display"),this.energyFill=document.getElementById("energy-bar-fill")}showHUD(){this.startScreen.classList.add("hidden"),this.shopOverlay.classList.add("hidden"),this.hud.classList.remove("hidden")}showShop(){this.hud.classList.add("hidden"),this.shopOverlay.classList.remove("hidden")}update(){if(this.game.state==="PLAYING"){this.goldDisplay.textContent=Math.floor(this.game.gold);const t=this.game.energy/this.game.maxEnergy*100;this.energyFill.style.width=`${Math.max(0,t)}%`}}}const L=[{id:"root",name:"Pirate Basics",description:"The start of your journey.",cost:0,x:270,y:40,effect:{},purchased:!0,parent:null},{id:"speed_1",name:"Peg Leg Polish",description:"+10% Movement Speed",cost:50,x:170,y:120,effect:{speed:25},purchased:!1,parent:"root"},{id:"damage_1",name:"Sharp Blade",description:"+25 Damage",cost:100,x:370,y:120,effect:{damage:25},purchased:!1,parent:"root"},{id:"cooldown_1",name:"Quick Hands",description:"-10% Swing Cooldown",cost:150,x:270,y:200,effect:{swingCooldown:-.1},purchased:!1,parent:"speed_1"},{id:"range_1",name:"Long Reach",description:"+20% Sword Range",cost:200,x:70,y:250,effect:{range:10},purchased:!1,parent:"speed_1"},{id:"arc_1",name:"Wild Swing",description:"Wider Swing Arc",cost:300,x:470,y:250,effect:{arc:30},purchased:!1,parent:"damage_1"},{id:"speed_attack_1",name:"Berserker",description:"+20% Atk Speed",cost:250,x:470,y:40,effect:{swingCooldown:-.2},purchased:!1,parent:"damage_1"},{id:"cannon_1",name:"Ship Support",description:"Auto-fire Cannons",cost:500,x:60,y:40,effect:{cannonLevel:1},purchased:!1,parent:"speed_1"},{id:"pet_1",name:"New Friend",description:"Unlock Carrot Pet",cost:400,x:270,y:280,effect:{petLevel:1},purchased:!1,parent:"cooldown_1"},{id:"pet_2",name:"Best Friend",description:"Evolve to Parrot",cost:1e3,x:270,y:360,effect:{petLevel:1},purchased:!1,parent:"pet_1"}];class M{constructor(t){this.game=t,this.nodes=JSON.parse(JSON.stringify(L)),this.container=document.getElementById("shop-items"),this.svgContainer=null}init(){if(console.log("SkillTree init called. Nodes:",this.nodes),!this.container){console.error("Shop container not found!");return}const t=document.getElementById("shop-gold-amount");t&&(t.innerText=this.game.gold),this.render()}render(){this.container.innerHTML="",this.svgContainer=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgContainer.style.position="absolute",this.svgContainer.style.top="0",this.svgContainer.style.left="0",this.svgContainer.style.width="100%",this.svgContainer.style.height="100%",this.svgContainer.style.pointerEvents="none",this.svgContainer.style.zIndex="0",this.container.appendChild(this.svgContainer),this.nodes.forEach(t=>{if(t.parent){const a=this.nodes.find(n=>n.id===t.parent);a&&this.drawLine(a.x,a.y,t.x,t.y,t.purchased)}const s=document.createElement("div");s.className=`skill-node ${t.purchased?"purchased":"locked"}`,s.style.left=`${t.x}px`,s.style.top=`${t.y}px`,s.setAttribute("data-desc",`${t.description}`);const e=this.nodes.find(a=>a.id===t.parent);!t.purchased&&(t.parent==="root"||e&&e.purchased)&&s.classList.add("available"),s.innerHTML=`
                <div class="name">${t.name}</div>
                <div class="cost">${t.cost}G</div>
            `,s.addEventListener("click",()=>this.buy(t)),this.container.appendChild(s)})}drawLine(t,s,e,i,a){const n=document.createElementNS("http://www.w3.org/2000/svg","line"),o=30;n.setAttribute("x1",t+o),n.setAttribute("y1",s+o),n.setAttribute("x2",e+o),n.setAttribute("y2",i+o),n.setAttribute("stroke",a?"#5d4037":"#ccc"),n.setAttribute("stroke-width","4"),n.setAttribute("stroke-dasharray",a?"none":"5,5"),this.svgContainer.appendChild(n)}buy(t){if(t.purchased)return;const s=this.nodes.find(e=>e.id===t.parent);if(!(t.parent!==null&&!s.purchased))if(this.game.gold>=t.cost){this.game.gold-=t.cost,t.purchased=!0,this.applyUpgrade(t.effect);const e=document.getElementById("shop-gold-amount");e&&(e.innerText=this.game.gold),this.render(),this.game.ui.update()}else{const e=document.querySelector(`.skill-node[style*="left: ${t.x}px"]`);e&&(e.classList.add("shake"),setTimeout(()=>e.classList.remove("shake"),500))}}applyUpgrade(t){const s=this.game.stats;t.speed&&(s.speed+=t.speed),t.damage&&(s.damage+=t.damage),t.swingCooldown&&(s.swingCooldown+=t.swingCooldown),t.range&&(s.range+=t.range),t.arc&&(s.arc+=t.arc),t.cannonLevel&&(s.cannonLevel+=t.cannonLevel),t.petLevel&&(s.petLevel+=t.petLevel)}}class A{constructor(t,s,e){this.game=t,this.x=s,this.y=e,this.width=40,this.height=40,this.type="Chest",this.markedForDeletion=!1,this.maxHp=150,this.hp=this.maxHp,this.invulnerable=!1,this.flashTimer=0,this.scaleY=1}takeDamage(t){this.hp-=t,this.flashTimer=.1,this.scaleY=.7,this.game.hitStop(.05),this.game.shake=5,g(async()=>{const{spawnParticles:s}=await import("./Particle-Bl0AywMg.js");return{spawnParticles:s}},[]).then(({spawnParticles:s})=>{s(this.game,this.x,this.y,"#8B4513",5,"splinter")}),this.hp<=0&&(this.markedForDeletion=!0,this.game.gold+=50,g(async()=>{const{spawnParticles:s}=await import("./Particle-Bl0AywMg.js");return{spawnParticles:s}},[]).then(({spawnParticles:s})=>{s(this.game,this.x,this.y,"#ffd700",20,"burst"),s(this.game,this.x,this.y,"#8B4513",10,"splinter")}),g(async()=>{const{FloatingText:s}=await import("./FloatingText-DIuYMBHa.js");return{FloatingText:s}},[]).then(({FloatingText:s})=>{this.game.texts.push(new s("+50G",this.x,this.y-30,"#ffd700",30))}))}update(t){this.flashTimer>0&&(this.flashTimer-=t),this.scaleY<1&&(this.scaleY+=t*5,this.scaleY>1&&(this.scaleY=1))}draw(t){const s=this.flashTimer>0?"#ffffff":null;m(t,this.game.assets.chest,this.x,this.y,this.width,this.height,0,1,this.scaleY,1,s),this.hp<this.maxHp&&y(t,this.x,this.y,this.width,this.hp,this.maxHp)}}class C{constructor(t,s,e){this.game=t,this.x=s,this.y=e,this.width=40,this.height=40,this.type="Rock",this.markedForDeletion=!1}update(t){}draw(t){m(t,this.game.assets.rock,this.x,this.y,this.width,this.height,0)}}class R{constructor(t,s,e){this.game=t,this.x=s,this.y=e,this.width=40,this.height=40,this.type="Crab",this.markedForDeletion=!1,this.maxHp=100,this.hp=this.maxHp,this.speed=50,this.dirX=Math.random()>.5?1:-1,this.dirY=Math.random()>.5?1:-1,this.changeDirTimer=0,this.invulnerable=!1,this.flashTimer=0,this.scaleY=1}takeDamage(t){this.hp-=t,this.flashTimer=.1,this.scaleY=.8,this.game.hitStop(.05),this.game.shake=5,g(async()=>{const{spawnParticles:s}=await import("./Particle-Bl0AywMg.js");return{spawnParticles:s}},[]).then(({spawnParticles:s})=>{s(this.game,this.x,this.y,"#ff0000",5,"splinter")}),this.hp<=0&&(this.markedForDeletion=!0,g(async()=>{const{spawnParticles:s}=await import("./Particle-Bl0AywMg.js");return{spawnParticles:s}},[]).then(({spawnParticles:s})=>{s(this.game,this.x,this.y,"#ff0000",15,"burst")}))}update(t){this.changeDirTimer+=t,this.changeDirTimer>2&&(this.changeDirTimer=0,this.dirX=Math.random()>.5?1:-1,this.dirY=Math.random()>.5?1:-1),this.x+=this.dirX*this.speed*t,this.y+=this.dirY*this.speed*t,(this.x<0||this.x>this.game.canvas.width)&&(this.dirX*=-1),(this.y<0||this.y>this.game.canvas.height)&&(this.dirY*=-1);const s=this.game.player.x-this.x,e=this.game.player.y-this.y;Math.sqrt(s*s+e*e)<30&&(this.game.energy-=20*t),this.flashTimer>0&&(this.flashTimer-=t),this.scaleY<1&&(this.scaleY+=t*5,this.scaleY>1&&(this.scaleY=1))}draw(t){const s=this.flashTimer>0?"#ff0000":null,e=Math.atan2(this.dirY,this.dirX)-Math.PI/2;m(t,this.game.assets.crab,this.x,this.y,this.width,this.height,e,1,this.scaleY,1,s),y(t,this.x,this.y,this.width,this.hp,this.maxHp)}}class O{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.resize(),window.addEventListener("resize",()=>this.resize()),this.input={keys:{},mouse:{x:0,y:0},rockHitCooldown:!1},this.setupInput(),this.state="START",this.lastTime=0,this.player=null,this.entities=[],this.particles=[],this.texts=[],this.gold=0,this.energy=999,this.maxEnergy=999,this.shake=0,this.stats={speed:250,damage:50,swingCooldown:.01,range:80,arc:0,cannonLevel:0,petLevel:0},this.energyDecayRate=8,this.ui=new S(this),this.skillTree=new M(this),this.assets={player:new Image,chest:new Image,rock:new Image,crab:new Image,sand:new Image},this.assetsLoaded=0,this.totalAssets=9,this.bgPattern=null,this.cannonTimer=0,this.hitStopDuration=0,this.loadAssets()}hitStop(t){this.hitStopDuration=t}loadAssets(){const t=(s,e)=>{const i=new Image;i.src=e,i.onload=()=>{s==="sand"?(this.assets[s]=i,this.assetsLoaded++,this.assetsLoaded===this.totalAssets&&console.log("All assets loaded")):g(async()=>{const{createTransparentSprite:a}=await Promise.resolve().then(()=>x);return{createTransparentSprite:a}},void 0).then(({createTransparentSprite:a})=>{this.assets[s]=a(i),this.assetsLoaded++,this.assetsLoaded===this.totalAssets&&console.log("All assets loaded & processed")})}};t("player","./sprites/player.png"),t("chest","./sprites/chest.png"),t("rock","./sprites/rock.png"),t("crab","./sprites/crab.png"),t("sand","./sprites/sand.png"),t("cannonball","./sprites/cannonball.png"),t("carrot","./sprites/carrot.png"),t("parrot","./sprites/parrot.png"),t("pirate","./sprites/pirate.png")}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}setupInput(){window.addEventListener("keydown",i=>{(i.code==="KeyW"||i.key==="w")&&(this.input.keys.w=!0),(i.code==="KeyA"||i.key==="a")&&(this.input.keys.a=!0),(i.code==="KeyS"||i.key==="s")&&(this.input.keys.s=!0),(i.code==="KeyD"||i.key==="d")&&(this.input.keys.d=!0),this.input.keys[i.key.toLowerCase()]=!0}),window.addEventListener("keyup",i=>{(i.code==="KeyW"||i.key==="w")&&(this.input.keys.w=!1),(i.code==="KeyA"||i.key==="a")&&(this.input.keys.a=!1),(i.code==="KeyS"||i.key==="s")&&(this.input.keys.s=!1),(i.code==="KeyD"||i.key==="d")&&(this.input.keys.d=!1),this.input.keys[i.key.toLowerCase()]=!1}),window.addEventListener("mousemove",i=>{const a=this.canvas.getBoundingClientRect();this.input.mouse.x=i.clientX-a.left,this.input.mouse.y=i.clientY-a.top});const t=()=>this.startGame(),s=document.getElementById("start-game-btn");s&&s.addEventListener("click",t);const e=document.getElementById("next-run-btn");e&&e.addEventListener("click",t)}startGame(){if(console.log("Starting Game..."),this.state="PLAYING",this.energy=this.maxEnergy,this.player=new P(this),this.entities=[],this.particles=[],this.texts=[],this.shake=0,this.stats.petLevel>0){const t=this.stats.petLevel===2?"parrot":"carrot";this.pet=new b(this,t)}else this.pet=null;for(let t=0;t<15;t++)this.spawnEntity("chest");for(let t=0;t<15;t++)this.spawnEntity("rock");for(let t=0;t<10;t++)this.spawnEntity("crab");for(let t=0;t<5;t++)this.spawnEntity("pirate");console.log(`Spawned ${this.entities.length} entities.`),this.ui.showHUD()}start(){requestAnimationFrame(t=>this.loop(t))}loop(t){const s=(t-this.lastTime)/1e3;this.lastTime=t,this.update(s),this.draw(),requestAnimationFrame(e=>this.loop(e))}update(t){if(this.state==="PLAYING"){if(this.hitStopDuration>0){this.hitStopDuration-=t;return}if(this.energy-=this.energyDecayRate*t,this.energy<=0&&(this.energy=0,this.state="SHOP",this.gameOver()),this.shake>0&&(this.shake-=t*30,this.shake<0&&(this.shake=0)),this.player&&this.player.update(t),this.pet&&this.pet.update(t),this.entities.forEach(s=>s.update(t)),this.particles.forEach(s=>s.update(t)),this.texts.forEach(s=>s.update(t)),this.entities=this.entities.filter(s=>!s.markedForDeletion),this.particles=this.particles.filter(s=>!s.markedForDeletion),this.texts=this.texts.filter(s=>!s.markedForDeletion),this.stats.cannonLevel>0&&(this.cannonTimer+=t,this.cannonTimer>=5&&(this.cannonTimer=0,this.fireCannons())),this.entities.length<20){const s=Math.random();s<.3?this.spawnEntity("chest"):s<.7?this.spawnEntity("crab"):this.spawnEntity("pirate")}}}gameOver(){console.log("Game Over - Opening Shop"),this.ui.showShop(),this.skillTree.init()}draw(){if(this.ctx.save(),this.shake>0){const t=(Math.random()-.5)*this.shake,s=(Math.random()-.5)*this.shake;this.ctx.translate(t,s)}if(this.assets.sand&&this.assets.sand.complete&&this.assets.sand.naturalWidth!==0?(this.bgPattern||(this.bgPattern=this.ctx.createPattern(this.assets.sand,"repeat")),this.ctx.fillStyle=this.bgPattern,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)):(this.ctx.fillStyle="#e0cda7",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)),this.state==="PLAYING"){const t=[...this.entities];this.player&&t.push(this.player),this.pet&&t.push(this.pet),t.sort((s,e)=>s.y-e.y),t.forEach(s=>s.draw(this.ctx)),this.particles.forEach(s=>s.draw(this.ctx)),this.texts.forEach(s=>s.draw(this.ctx))}this.ctx.restore(),this.ui.update()}spawnEntity(t){const s=Math.random()*(this.canvas.width-100)+50,e=Math.random()*(this.canvas.height-100)+50;t==="chest"&&this.entities.push(new A(this,s,e)),t==="rock"&&this.entities.push(new C(this,s,e)),t==="crab"&&this.entities.push(new R(this,s,e)),t==="pirate"&&this.entities.push(new I(this,s,e))}fireCannons(){const t=this.stats.cannonLevel*1;for(let s=0;s<t;s++){const e=this.player.x+(Math.random()-.5)*600,i=this.player.y+(Math.random()-.5)*600;setTimeout(()=>{this.entities.push(new D(this,e,i))},s*200)}this.texts.push(new FloatingText("CANNON BARRAGE!",this.player.x,this.player.y-100,"#ff4400",30))}}window.addEventListener("load",()=>{const h=document.getElementById("game-canvas");new O(h).start()});
