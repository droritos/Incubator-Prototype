(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}})();const v="modulepreload",E=function(r){return"/Incubator-Prototype/"+r},m={},c=function(t,e,i){let s=Promise.resolve();if(e&&e.length>0){let n=function(o){return Promise.all(o.map(f=>Promise.resolve(f).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),d=(h==null?void 0:h.nonce)||(h==null?void 0:h.getAttribute("nonce"));s=n(e.map(o=>{if(o=E(o),o in m)return;m[o]=!0;const f=o.endsWith(".css"),p=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${p}`))return;const l=document.createElement("link");if(l.rel=f?"stylesheet":v,f||(l.as="script"),l.crossOrigin="",l.href=o,d&&l.setAttribute("nonce",d),document.head.appendChild(l),f)return new Promise((w,k)=>{l.addEventListener("load",w),l.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${o}`)))})}))}function a(n){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=n,window.dispatchEvent(h),!h.defaultPrevented)throw n}return s.then(n=>{for(const h of n||[])h.status==="rejected"&&a(h.reason);return t().catch(a)})};function u(r,t,e,i,s,a,n=0,h=1,d=1){t&&(r.save(),r.globalAlpha=d,r.translate(e,i),r.rotate(n),r.scale(h,1),r.drawImage(t,-s/2,-a/2,s,a),r.restore())}function x(r){const t=document.createElement("canvas");t.width=r.width,t.height=r.height;const e=t.getContext("2d");e.drawImage(r,0,0);const i=e.getImageData(0,0,t.width,t.height),s=i.data;for(let n=0;n<s.length;n+=4){const h=s[n],d=s[n+1],o=s[n+2];h>230&&d>230&&o>230&&(s[n+3]=0)}e.putImageData(i,0,0);const a=new Image;return a.src=t.toDataURL(),a}const _=Object.freeze(Object.defineProperty({__proto__:null,createTransparentSprite:x,drawSprite:u},Symbol.toStringTag,{value:"Module"}));class b{constructor(t,e,i){this.game=t,this.tx=e,this.ty=i,this.x=e,this.y=i-600,this.speed=400,this.radius=20,this.damage=100,this.markedForDeletion=!1,this.shadowScale=0}update(t){this.y+=this.speed*t;const e=this.ty-this.y;this.shadowScale=Math.max(0,1-e/600),this.y>=this.ty&&this.explode()}explode(){this.markedForDeletion=!0,this.game.shake=15,c(async()=>{const{spawnParticles:e}=await import("./Particle-DPDeZQbK.js");return{spawnParticles:e}},[]).then(({spawnParticles:e})=>{e(this.game,this.tx,this.ty,"#ff4400",15,"burst"),e(this.game,this.tx,this.ty,"#555555",10,"smoke")});const t=100;this.game.entities.forEach(e=>{const i=e.x-this.tx,s=e.y-this.ty;Math.sqrt(i*i+s*s)<t&&e.takeDamage&&(e.takeDamage(this.damage),c(async()=>{const{FloatingText:n}=await Promise.resolve().then(()=>y);return{FloatingText:n}},void 0).then(({FloatingText:n})=>{this.game.texts.push(new n(this.damage,e.x,e.y-30,"#ff4400",25))}))})}draw(t){t.save(),t.translate(this.tx,this.ty),t.scale(this.shadowScale,this.shadowScale),t.fillStyle="rgba(0,0,0,0.3)",t.beginPath(),t.ellipse(0,0,20,10,0,0,Math.PI*2),t.fill(),t.restore(),this.game.assets.cannonball?u(t,this.game.assets.cannonball,this.x,this.y,40,40,0):(t.fillStyle="#111",t.beginPath(),t.arc(this.x,this.y,this.radius,0,Math.PI*2),t.fill())}}class P{constructor(t,e){this.game=t,this.type=e,this.x=t.player.x,this.y=t.player.y,this.width=40,this.height=40,this.target=null,this.state="idle",this.timer=0,this.type==="carrot"?(this.damage=25,this.speed=150,this.range=30,this.attackCooldown=1):(this.damage=40,this.speed=200,this.range=250,this.attackCooldown=.8,this.facingX=1),this.cooldownTimer=0}upgrade(){this.type="parrot",this.damage=40,this.speed=200,this.range=250,this.attackCooldown=.8,c(async()=>{const{spawnParticles:t}=await import("./Particle-DPDeZQbK.js");return{spawnParticles:t}},[]).then(({spawnParticles:t})=>{t(this.game,this.x,this.y,"#00ffcc",20,"burst")})}update(t){if(this.cooldownTimer-=t,(!this.target||this.target.markedForDeletion||this.target.hp<=0)&&(this.target=this.findNearestEnemy(),!this.target)){this.moveTo(this.game.player.x,this.game.player.y-50,t);return}const e=this.target.x-this.x,i=this.target.y-this.y,s=Math.sqrt(e*e+i*i);e>0&&(this.facingX=1),e<0&&(this.facingX=-1),s<=this.range?this.cooldownTimer<=0&&(this.attack(this.target),this.cooldownTimer=this.attackCooldown):(this.moveTo(this.target.x,this.target.y,t),this.type==="carrot"&&(this.timer+=t*10,this.y+=Math.sin(this.timer)*.5))}moveTo(t,e,i){const s=t-this.x,a=e-this.y,n=Math.sqrt(s*s+a*a);n>5&&(this.x+=s/n*this.speed*i,this.y+=a/n*this.speed*i)}findNearestEnemy(){let t=null,e=9999;return this.game.entities.forEach(i=>{if((i.type==="Chest"||i.type==="Crab"||i.type==="Rock")&&i.hp>0){const s=Math.hypot(i.x-this.x,i.y-this.y);s<e&&(e=s,t=i)}}),t}attack(t){if(this.type==="carrot"){t.takeDamage(this.damage);const e=t.x-this.x,i=t.y-this.y;this.x+=e*.2,this.y+=i*.2,c(async()=>{const{FloatingText:s}=await Promise.resolve().then(()=>y);return{FloatingText:s}},void 0).then(({FloatingText:s})=>{this.game.texts.push(new s(this.damage,t.x,t.y-20,"#ffa500",16))})}else t.takeDamage(this.damage),c(async()=>{const{spawnParticles:e}=await import("./Particle-DPDeZQbK.js");return{spawnParticles:e}},[]).then(({spawnParticles:e})=>{e(this.game,t.x,t.y,"#ff0000",3,"spark")}),c(async()=>{const{FloatingText:e}=await Promise.resolve().then(()=>y);return{FloatingText:e}},void 0).then(({FloatingText:e})=>{this.game.texts.push(new e(this.damage,t.x,t.y-20,"#00ccff",18))})}draw(t){t.fillStyle="rgba(0,0,0,0.2)",t.beginPath(),t.ellipse(this.x,this.y+this.height/2-5,10,5,0,0,Math.PI*2),t.fill();let e=this.type==="carrot"?this.game.assets.carrot:this.game.assets.parrot;if(e){let i=0;this.type==="parrot"&&(i=Math.sin(Date.now()/200)*10-20),u(t,e,this.x,this.y+i,this.width,this.height,0,this.facingX||1)}else t.fillStyle=this.type==="carrot"?"orange":"red",t.fillRect(this.x-10,this.y-20,20,40)}}class g{constructor(t,e,i,s="#fff",a=20){this.text=t,this.x=e,this.y=i,this.color=s,this.size=a,this.life=1,this.vy=-50,this.markedForDeletion=!1}update(t){this.y+=this.vy*t,this.life-=t,this.life<=0&&(this.markedForDeletion=!0)}draw(t){t.save(),t.globalAlpha=Math.max(0,this.life),t.fillStyle=this.color,t.font=`bold ${this.size}px monospace`,t.strokeStyle="#000",t.lineWidth=3,t.strokeText(this.text,this.x,this.y),t.fillText(this.text,this.x,this.y),t.restore()}}const y=Object.freeze(Object.defineProperty({__proto__:null,FloatingText:g},Symbol.toStringTag,{value:"Module"}));class L{constructor(t){this.stats={speed:250,damage:50,swingCooldown:.1,range:80,arc:0,cannonLevel:0,petLevel:0},this.assets={player:new Image,chest:new Image,rock:new Image,crab:new Image,sand:new Image,cannonball:new Image,carrot:new Image,parrot:new Image},this.assetsLoaded=0,this.totalAssets=8,this.cannonTimer=0,this.pet=null,this.loadAssets()}loadAssets(){const t=(e,i)=>{const s=new Image;s.src=i,s.onload=()=>{e==="sand"?(this.assets[e]=s,this.assetsLoaded++,this.assetsLoaded===this.totalAssets&&console.log("All assets loaded")):c(async()=>{const{createTransparentSprite:a}=await Promise.resolve().then(()=>_);return{createTransparentSprite:a}},void 0).then(({createTransparentSprite:a})=>{this.assets[e]=a(s),this.assetsLoaded++,this.assetsLoaded===this.totalAssets&&console.log("All assets loaded & processed")})}};t("player","./sprites/player.png"),t("chest","./sprites/chest.png"),t("rock","./sprites/rock.png"),t("crab","./sprites/crab.png"),t("sand","./sprites/sand.png"),t("cannonball","./sprites/cannonball.png"),t("carrot","./sprites/carrot.png"),t("parrot","./sprites/parrot.png")}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}setupInput(){window.addEventListener("keydown",s=>{(s.code==="KeyW"||s.key==="w")&&(this.input.keys.w=!0),(s.code==="KeyA"||s.key==="a")&&(this.input.keys.a=!0),(s.code==="KeyS"||s.key==="s")&&(this.input.keys.s=!0),(s.code==="KeyD"||s.key==="d")&&(this.input.keys.d=!0),this.input.keys[s.key.toLowerCase()]=!0}),window.addEventListener("keyup",s=>{(s.code==="KeyW"||s.key==="w")&&(this.input.keys.w=!1),(s.code==="KeyA"||s.key==="a")&&(this.input.keys.a=!1),(s.code==="KeyS"||s.key==="s")&&(this.input.keys.s=!1),(s.code==="KeyD"||s.key==="d")&&(this.input.keys.d=!1),this.input.keys[s.key.toLowerCase()]=!1}),window.addEventListener("mousemove",s=>{const a=this.canvas.getBoundingClientRect();this.input.mouse.x=s.clientX-a.left,this.input.mouse.y=s.clientY-a.top});const t=()=>this.startGame(),e=document.getElementById("start-game-btn");e&&e.addEventListener("click",t);const i=document.getElementById("next-run-btn");i&&i.addEventListener("click",t)}startGame(){if(console.log("Starting Game..."),this.state="PLAYING",this.energy=this.maxEnergy,this.player=new Player(this),this.entities=[],this.particles=[],this.texts=[],this.shake=0,this.stats.petLevel>0){const t=this.stats.petLevel===2?"parrot":"carrot";this.pet=new P(this,t)}else this.pet=null;for(let t=0;t<15;t++)this.spawnEntity("chest");for(let t=0;t<15;t++)this.spawnEntity("rock");for(let t=0;t<10;t++)this.spawnEntity("crab");console.log(`Spawned ${this.entities.length} entities.`),this.ui.showHUD()}spawnEntity(t){const e=Math.random()*(this.canvas.width-100)+50,i=Math.random()*(this.canvas.height-100)+50;t==="chest"&&this.entities.push(new Chest(this,e,i)),t==="rock"&&this.entities.push(new Rock(this,e,i)),t==="crab"&&this.entities.push(new Crab(this,e,i))}start(){requestAnimationFrame(t=>this.loop(t))}loop(t){const e=(t-this.lastTime)/1e3;this.lastTime=t,this.update(e),this.draw(),requestAnimationFrame(i=>this.loop(i))}update(t){this.state==="PLAYING"&&(this.energy-=this.energyDecayRate*t,this.energy<=0&&(this.energy=0,this.state="SHOP",this.gameOver()),this.shake>0&&(this.shake-=t*30,this.shake<0&&(this.shake=0)),this.player&&this.player.update(t),this.pet&&this.pet.update(t),this.entities.forEach(e=>e.update(t)),this.particles.forEach(e=>e.update(t)),this.texts.forEach(e=>e.update(t)),this.entities=this.entities.filter(e=>!e.markedForDeletion),this.particles=this.particles.filter(e=>!e.markedForDeletion),this.texts=this.texts.filter(e=>!e.markedForDeletion),this.stats.cannonLevel>0&&(this.cannonTimer+=t,this.cannonTimer>=5&&(this.cannonTimer=0,this.fireCannons())),this.entities.length<20&&(Math.random()>.5?this.spawnEntity("chest"):this.spawnEntity("crab")))}fireCannons(){const t=this.stats.cannonLevel*1;for(let e=0;e<t;e++){const i=this.player.x+(Math.random()-.5)*600,s=this.player.y+(Math.random()-.5)*600;setTimeout(()=>{this.entities.push(new b(this,i,s))},e*200)}this.texts.push(new g("CANNON BARRAGE!",this.player.x,this.player.y-100,"#ff4400",30))}gameOver(){console.log("Game Over - Opening Shop"),this.ui.showShop(),this.skillTree.init()}draw(){if(this.ctx.save(),this.shake>0){const t=(Math.random()-.5)*this.shake,e=(Math.random()-.5)*this.shake;this.ctx.translate(t,e)}if(this.assets.sand&&this.assets.sand.complete&&this.assets.sand.naturalWidth!==0?(this.bgPattern||(this.bgPattern=this.ctx.createPattern(this.assets.sand,"repeat")),this.ctx.fillStyle=this.bgPattern,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)):(this.ctx.fillStyle="#e0cda7",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)),this.state==="PLAYING"){const t=[...this.entities];this.player&&t.push(this.player),this.pet&&t.push(this.pet),t.sort((e,i)=>e.y-i.y),t.forEach(e=>e.draw(this.ctx)),this.particles.forEach(e=>e.draw(this.ctx)),this.texts.forEach(e=>e.draw(this.ctx))}this.ctx.restore(),this.ui.update()}}window.addEventListener("load",()=>{const r=document.getElementById("game-canvas");new L(r).start()});
