(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const h of i)if(h.type==="childList")for(const a of h.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&e(a)}).observe(document,{childList:!0,subtree:!0});function s(i){const h={};return i.integrity&&(h.integrity=i.integrity),i.referrerPolicy&&(h.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?h.credentials="include":i.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function e(i){if(i.ep)return;i.ep=!0;const h=s(i);fetch(i.href,h)}})();const E="modulepreload",P=function(n){return"/Incubator-Prototype/"+n},y={},c=function(t,s,e){let i=Promise.resolve();if(s&&s.length>0){let a=function(o){return Promise.all(o.map(l=>Promise.resolve(l).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),d=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));i=a(s.map(o=>{if(o=P(o),o in y)return;y[o]=!0;const l=o.endsWith(".css"),m=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${m}`))return;const g=document.createElement("link");if(g.rel=l?"stylesheet":E,l||(g.as="script"),g.crossOrigin="",g.href=o,d&&g.setAttribute("nonce",d),document.head.appendChild(g),l)return new Promise((T,_)=>{g.addEventListener("load",T),g.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${o}`)))})}))}function h(a){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=a,window.dispatchEvent(r),!r.defaultPrevented)throw a}return i.then(a=>{for(const r of a||[])r.status==="rejected"&&h(r.reason);return t().catch(h)})};function w(n,t,s,e,i,h){const r=v(h,-20);n.fillStyle=r,n.beginPath(),n.moveTo(t+e/2,s-i),n.lineTo(t+e/2+10,s-i+10),n.lineTo(t+e/2+10,s+10),n.lineTo(t+e/2,s),n.fill(),n.beginPath(),n.moveTo(t-e/2,s),n.lineTo(t-e/2+10,s+10),n.lineTo(t+e/2+10,s+10),n.lineTo(t+e/2,s),n.fill(),n.fillStyle=h,n.fillRect(t-e/2,s-i,e,i)}function f(n,t,s,e,i,h,a=0,r=1,d=1,o=1,l=null){t&&(n.save(),n.globalAlpha=o,n.translate(s,e),n.rotate(a),n.scale(r,d),n.drawImage(t,-i/2,-h/2,i,h),l&&(n.globalCompositeOperation="source-atop",n.fillStyle=l,n.fillRect(-i/2,-h/2,i,h)),n.restore())}function v(n,t){let s=parseInt(n.substring(1,3),16),e=parseInt(n.substring(3,5),16),i=parseInt(n.substring(5,7),16);return s=parseInt(s*(100+t)/100),e=parseInt(e*(100+t)/100),i=parseInt(i*(100+t)/100),s=s<255?s:255,e=e<255?e:255,i=i<255?i:255,s=Math.round(s),e=Math.round(e),i=Math.round(i),"#"+(16777216+(Math.round(s)*65536+Math.round(e)*256+Math.round(i))).toString(16).slice(1)}function x(n){const t=document.createElement("canvas");t.width=n.width,t.height=n.height;const s=t.getContext("2d");s.drawImage(n,0,0);const e=s.getImageData(0,0,t.width,t.height),i=e.data;for(let a=0;a<i.length;a+=4){const r=i[a],d=i[a+1],o=i[a+2];r>230&&d>230&&o>230&&(i[a+3]=0)}s.putImageData(e,0,0);const h=new Image;return h.src=t.toDataURL(),h}function u(n,t,s,e,i,h){if(i>=h)return;const a=e,r=5,d=Math.max(0,i/h);n.fillStyle="#333",n.fillRect(t-a/2,s-e/2-10,a,r),n.fillStyle=d>.5?"#00ff00":d>.25?"#ffff00":"#ff0000",n.fillRect(t-a/2,s-e/2-10,a*d,r)}const b=Object.freeze(Object.defineProperty({__proto__:null,createTransparentSprite:x,drawBlockyRect:w,drawHealthBar:u,drawSprite:f,shadeColor:v},Symbol.toStringTag,{value:"Module"}));class D{constructor(t){this.game=t,this.x=t.canvas.width/2,this.y=t.canvas.height/2,this.width=64,this.height=64,this.speed=t.stats.speed,this.color="#ff4d4d",this.swingTimer=0,this.swingCooldown=Math.max(.05,t.stats.swingCooldown),this.isSwinging=!1,this.swingDuration=.2,this.swordAngle=0,this.swingDirection=1,this.facingX=1,this.pistolCooldown=1,this.pistolTimer=0,this.pistolAnimTimer=0,this.pistolAnimDuration=.6,this.pistolTargetAngle=0}update(t){if(this.pistolTimer>0&&(this.pistolTimer-=t),this.pistolAnimTimer>0&&(this.pistolAnimTimer-=t),this.game.input.fire&&this.pistolTimer<=0&&this.firePistol(),this.game.controlMode==="WASD"){let s=0,e=0;if(this.game.input.keys.w&&(e-=1),this.game.input.keys.s&&(e+=1),this.game.input.keys.a&&(s-=1),this.game.input.keys.d&&(s+=1),s!==0||e!==0){const a=Math.sqrt(s*s+e*e);s/=a,e/=a,s>0&&(this.facingX=1),s<0&&(this.facingX=-1)}this.x+=s*this.speed*t,this.y+=e*this.speed*t;const i=this.game.input.mouse.x,h=this.game.input.mouse.y;this.swordAngle=Math.atan2(h-this.y,i-this.x)}else{const s=this.game.input.mouse.x,e=this.game.input.mouse.y,i=s-this.x,h=e-this.y,a=Math.sqrt(i*i+h*h);let r=9999,d=null;if(this.game.entities.forEach(o=>{if(o.hp>0&&!o.markedForDeletion){const l=o.x-this.x,m=o.y-this.y,g=Math.sqrt(l*l+m*m);g<r&&g<400&&(r=g,d=o)}}),d){const o=d.x-this.x,l=d.y-this.y;let g=Math.atan2(l,o)-this.swordAngle;for(;g>Math.PI;)g-=Math.PI*2;for(;g<-Math.PI;)g+=Math.PI*2;this.swordAngle+=g*10*t}else if(a>10){let l=Math.atan2(h,i)-this.swordAngle;for(;l>Math.PI;)l-=Math.PI*2;for(;l<-Math.PI;)l+=Math.PI*2;this.swordAngle+=l*10*t}if(a>10){const o=i/a,l=h/a;o>0&&(this.facingX=1),o<0&&(this.facingX=-1),this.x+=o*this.speed*t,this.y+=l*this.speed*t}}this.x=Math.max(0,Math.min(this.game.canvas.width,this.x)),this.y=Math.max(0,Math.min(this.game.canvas.height,this.y)),this.swingCooldown=Math.max(.05,this.game.stats.swingCooldown),this.isSwinging?(this.swingTimer+=t,this.swingTimer>=this.swingDuration?(this.isSwinging=!1,this.swingTimer=0):this.checkCollisions()):(this.swingTimer+=t,this.swingTimer>=this.swingCooldown&&this.startSwing())}firePistol(){let t=0,s=null;const e=600;this.game.entities.forEach(i=>{if(i.hp>0&&!i.markedForDeletion){const h=i.x-this.x,a=i.y-this.y,r=Math.sqrt(h*h+a*a);r>t&&r<e&&(t=r,s=i)}}),s&&(this.pistolTimer=this.pistolCooldown,this.pistolAnimTimer=this.pistolAnimDuration,this.pistolTargetAngle=Math.atan2(s.y-this.y,s.x-this.x),s.takeDamage(this.game.stats.damage*2),this.game.shake=5,c(async()=>{const{FloatingText:i}=await Promise.resolve().then(()=>p);return{FloatingText:i}},void 0).then(({FloatingText:i})=>{this.game.texts.push(new i("BANG!",this.x,this.y-50,"#ff4400",24))}),c(async()=>{const{spawnParticles:i}=await import("./Particle-Bl0AywMg.js");return{spawnParticles:i}},[]).then(({spawnParticles:i})=>{i(this.game,this.x+30*this.facingX,this.y,"#ffff00",10,"explosion"),i(this.game,this.x+30*this.facingX,this.y,"#333333",15,"burst")}),this.game.particles.push({x:this.x+30*this.facingX,y:this.y,tx:s.x,ty:s.y,life:.6,update:function(i){this.life-=i},draw:function(i){i.save(),i.globalAlpha=Math.min(1,this.life/.3),i.strokeStyle="#222222",i.lineWidth=6,i.setLineDash([20,10]),i.beginPath(),i.moveTo(this.x,this.y),i.lineTo(this.tx,this.ty),i.stroke(),i.strokeStyle="#aaaaaa",i.lineWidth=2,i.setLineDash([]),i.stroke(),i.restore()}}))}startSwing(){this.isSwinging=!0,this.swingTimer=0,this.swingDirection*=-1}checkCollisions(){const t=50+this.game.stats.range,s=Math.PI/3+this.game.stats.arc*Math.PI/180;this.game.entities.forEach(e=>{const i=e.x-this.x,h=e.y-this.y;if(Math.sqrt(i*i+h*h)<t){let d=Math.atan2(h,i)-this.swordAngle;for(;d>Math.PI;)d-=Math.PI*2;for(;d<-Math.PI;)d+=Math.PI*2;if(Math.abs(d)<s/2){if(e.type==="Chest")e.hp>0&&!e.invulnerable&&(e.takeDamage(this.game.stats.damage),c(async()=>{const{FloatingText:o}=await Promise.resolve().then(()=>p);return{FloatingText:o}},void 0).then(({FloatingText:o})=>{this.game.texts.push(new o(this.game.stats.damage,e.x,e.y-20,"#fff",20))}),e.invulnerable=!0,setTimeout(()=>e.invulnerable=!1,200));else if(e.type==="Rock")this.game.input.rockHitCooldown||(this.game.energy-=10,this.game.shake=10,c(async()=>{const{spawnParticles:o}=await import("./Particle-Bl0AywMg.js");return{spawnParticles:o}},[]).then(({spawnParticles:o})=>{o(this.game,e.x,e.y,"#ffffff",5,"spark")}),c(async()=>{const{FloatingText:o}=await Promise.resolve().then(()=>p);return{FloatingText:o}},void 0).then(({FloatingText:o})=>{this.game.texts.push(new o("-10 Energy",this.x,this.y-40,"#ff4d4d",16))}),this.game.input.rockHitCooldown=!0,setTimeout(()=>this.game.input.rockHitCooldown=!1,500));else if(e.type==="Crab"){if(e.hp>0&&!e.invulnerable){const o=this.game.stats.damage;e.takeDamage(o),c(async()=>{const{FloatingText:l}=await Promise.resolve().then(()=>p);return{FloatingText:l}},void 0).then(({FloatingText:l})=>{this.game.texts.push(new l(o,e.x,e.y-20,"#fff",20))}),e.invulnerable=!0,setTimeout(()=>e.invulnerable=!1,250)}}else if(e.type==="Pirate"&&e.hp>0&&!e.invulnerable){const o=this.game.stats.damage;e.takeDamage(o),c(async()=>{const{FloatingText:l}=await Promise.resolve().then(()=>p);return{FloatingText:l}},void 0).then(({FloatingText:l})=>{this.game.texts.push(new l(o,e.x,e.y-40,"#ff0000",20))}),e.invulnerable=!0,setTimeout(()=>e.invulnerable=!1,250)}}}})}draw(t){t.fillStyle="rgba(0,0,0,0.2)",t.beginPath(),t.ellipse(this.x,this.y,this.width/2,12,0,0,Math.PI*2),t.fill();const s=50+this.game.stats.range,e=Math.PI/3+this.game.stats.arc*Math.PI/180;if(t.save(),t.translate(this.x,this.y),t.beginPath(),t.moveTo(0,0),t.arc(0,0,s,this.swordAngle-e/2,this.swordAngle+e/2),t.fillStyle="rgba(255, 255, 255, 0.15)",t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.4)",t.lineWidth=1,t.stroke(),t.restore(),this.game.assets&&this.game.assets.player?f(t,this.game.assets.player,this.x,this.y,this.width,this.height,0,this.facingX):w(t,this.x,this.y,30,50,this.color),this.pistolAnimTimer>0&&this.game.assets.pistol){t.save(),t.translate(this.x,this.y-10);const h=this.pistolAnimTimer/this.pistolAnimDuration,a=Math.sin(h*Math.PI)*1.5;let r=this.pistolTargetAngle;this.facingX===-1&&(r=Math.PI-r);const d=(1-h)*-.5;t.rotate(r+d),t.scale(this.facingX*a,a),t.drawImage(this.game.assets.pistol,-28,-28,56,56),t.restore()}t.save(),t.translate(this.x,this.y);let i=this.swordAngle;if(this.isSwinging){const h=this.swingTimer/this.swingDuration;let a=-e/2,r=e/2;this.swingDirection===-1&&(a=e/2,r=-e/2);const d=a+(r-a)*h;i+=d}else i+=e/2*this.swingDirection;if(t.rotate(i),t.translate(20,0),t.fillStyle="#C0C0C0",t.shadowColor="#fff",t.shadowBlur=5,t.fillRect(0,-2,s-20,6),t.shadowBlur=0,t.fillStyle="#654321",t.fillRect(-5,-3,15,6),t.fillStyle="#ffd700",t.fillRect(-5,-6,4,12),this.isSwinging){const h=this.swingTimer/this.swingDuration;t.beginPath(),this.swingDirection===1?-e/2:e/2,this.swingDirection===1?-e/2+e*h:e/2-e*h,t.moveTo(-20,0),t.lineTo(s-20,0),t.strokeStyle=`rgba(255, 255, 255, ${.8-h})`,t.lineWidth=4,t.stroke()}t.restore()}}class S{constructor(t,s){this.game=t,this.type=s,this.x=t.player.x,this.y=t.player.y,this.width=40,this.height=40,this.target=null,this.state="idle",this.timer=0,this.type==="carrot"?(this.damage=25,this.speed=150,this.range=30,this.attackCooldown=1):(this.damage=40,this.speed=200,this.range=250,this.attackCooldown=.8,this.facingX=1),this.cooldownTimer=0}upgrade(){this.type="parrot",this.damage=40,this.speed=200,this.range=250,this.attackCooldown=.8,c(async()=>{const{spawnParticles:t}=await import("./Particle-Bl0AywMg.js");return{spawnParticles:t}},[]).then(({spawnParticles:t})=>{t(this.game,this.x,this.y,"#00ffcc",20,"burst")})}update(t){if(this.cooldownTimer-=t,(!this.target||this.target.markedForDeletion||this.target.hp<=0)&&(this.target=this.findNearestEnemy(),!this.target)){this.moveTo(this.game.player.x,this.game.player.y-50,t);return}const s=this.target.x-this.x,e=this.target.y-this.y,i=Math.sqrt(s*s+e*e);s>0&&(this.facingX=1),s<0&&(this.facingX=-1),i<=this.range?this.cooldownTimer<=0&&(this.attack(this.target),this.cooldownTimer=this.attackCooldown):(this.moveTo(this.target.x,this.target.y,t),this.type==="carrot"&&(this.timer+=t*10,this.y+=Math.sin(this.timer)*.5))}moveTo(t,s,e){const i=t-this.x,h=s-this.y,a=Math.sqrt(i*i+h*h);a>5&&(this.x+=i/a*this.speed*e,this.y+=h/a*this.speed*e)}findNearestEnemy(){let t=null,s=9999;return this.game.entities.forEach(e=>{if((e.type==="Chest"||e.type==="Crab"||e.type==="Rock")&&e.hp>0){const i=Math.hypot(e.x-this.x,e.y-this.y);i<s&&(s=i,t=e)}}),t}attack(t){if(this.type==="carrot"){t.takeDamage(this.damage);const s=t.x-this.x,e=t.y-this.y;this.x+=s*.2,this.y+=e*.2,c(async()=>{const{FloatingText:i}=await Promise.resolve().then(()=>p);return{FloatingText:i}},void 0).then(({FloatingText:i})=>{this.game.texts.push(new i(this.damage,t.x,t.y-20,"#ffa500",16))})}else t.takeDamage(this.damage),c(async()=>{const{spawnParticles:s}=await import("./Particle-Bl0AywMg.js");return{spawnParticles:s}},[]).then(({spawnParticles:s})=>{s(this.game,t.x,t.y,"#ff0000",3,"spark")}),c(async()=>{const{FloatingText:s}=await Promise.resolve().then(()=>p);return{FloatingText:s}},void 0).then(({FloatingText:s})=>{this.game.texts.push(new s(this.damage,t.x,t.y-20,"#00ccff",18))})}draw(t){t.fillStyle="rgba(0,0,0,0.2)",t.beginPath(),t.ellipse(this.x,this.y+this.height/2-5,10,5,0,0,Math.PI*2),t.fill();let s=this.type==="carrot"?this.game.assets.carrot:this.game.assets.parrot;if(s){let e=0;this.type==="parrot"&&(e=Math.sin(Date.now()/200)*10-20),f(t,s,this.x,this.y+e,this.width,this.height,0,this.facingX||1)}else t.fillStyle=this.type==="carrot"?"orange":"red",t.fillRect(this.x-10,this.y-20,20,40)}}class A{constructor(t,s,e){this.game=t,this.tx=s,this.ty=e,this.x=s,this.y=e-600,this.speed=400,this.radius=20,this.damage=100,this.markedForDeletion=!1,this.shadowScale=0}update(t){this.y+=this.speed*t;const s=this.ty-this.y;this.shadowScale=Math.max(0,1-s/600),this.y>=this.ty&&this.explode()}explode(){this.markedForDeletion=!0,this.game.shake=15,c(async()=>{const{spawnParticles:s}=await import("./Particle-Bl0AywMg.js");return{spawnParticles:s}},[]).then(({spawnParticles:s})=>{s(this.game,this.tx,this.ty,"#ff4400",15,"burst"),s(this.game,this.tx,this.ty,"#555555",10,"smoke")});const t=100;this.game.entities.forEach(s=>{const e=s.x-this.tx,i=s.y-this.ty;Math.sqrt(e*e+i*i)<t&&s.takeDamage&&(s.takeDamage(this.damage),c(async()=>{const{FloatingText:a}=await Promise.resolve().then(()=>p);return{FloatingText:a}},void 0).then(({FloatingText:a})=>{this.game.texts.push(new a(this.damage,s.x,s.y-30,"#ff4400",25))}))})}draw(t){t.save(),t.translate(this.tx,this.ty),t.scale(this.shadowScale,this.shadowScale),t.fillStyle="rgba(0,0,0,0.3)",t.beginPath(),t.ellipse(0,0,20,10,0,0,Math.PI*2),t.fill(),t.restore(),this.game.assets.cannonball?f(t,this.game.assets.cannonball,this.x,this.y,40,40,0):(t.fillStyle="#111",t.beginPath(),t.arc(this.x,this.y,this.radius,0,Math.PI*2),t.fill())}}class M{constructor(t,s,e){this.game=t,this.x=s,this.y=e,this.width=50,this.height=50,this.type="Pirate",this.markedForDeletion=!1,this.maxHp=250,this.hp=this.maxHp,this.speed=80,this.dirX=Math.random()>.5?1:-1,this.dirY=Math.random()>.5?1:-1,this.changeDirTimer=0,this.invulnerable=!1}takeDamage(t){this.hp-=t,this.hp<=0&&(this.markedForDeletion=!0,this.game.gold+=50,c(async()=>{const{FloatingText:s}=await Promise.resolve().then(()=>p);return{FloatingText:s}},void 0).then(({FloatingText:s})=>{this.game.texts.push(new s("+50G",this.x,this.y,"#ffd700",20))}))}update(t){const s=this.game.player.x-this.x,e=this.game.player.y-this.y,i=Math.sqrt(s*s+e*e);i<400?(this.dirX=s>0?1:-1,this.dirY=e>0?1:-1,this.x+=s/i*this.speed*t,this.y+=e/i*this.speed*t):(this.changeDirTimer+=t,this.changeDirTimer>2&&(this.changeDirTimer=0,this.dirX=Math.random()>.5?1:-1,this.dirY=Math.random()>.5?1:-1),this.x+=this.dirX*(this.speed*.5)*t,this.y+=this.dirY*(this.speed*.5)*t),this.x<0&&(this.x=0),this.x>this.game.canvas.width&&(this.x=this.game.canvas.width),this.y<0&&(this.y=0),this.y>this.game.canvas.height&&(this.y=this.game.canvas.height),i<40&&(this.game.energy-=15*t),this.flashTimer>0&&(this.flashTimer-=t),this.scaleY<1&&(this.scaleY+=t*5,this.scaleY>1&&(this.scaleY=1))}draw(t){let s=this.dirX;const e=this.flashTimer>0?"#ff0000":null;f(t,this.game.assets.pirate,this.x,this.y,this.width,this.height,0,s,this.scaleY,1,e),u(t,this.x,this.y,this.width,this.hp,this.maxHp)}}class I{constructor(t){this.game=t,this.hud=document.getElementById("hud"),this.startScreen=document.getElementById("start-screen"),this.shopOverlay=document.getElementById("shop-overlay"),this.goldDisplay=document.getElementById("gold-display"),this.energyFill=document.getElementById("energy-bar-fill")}showHUD(){this.startScreen.classList.add("hidden"),this.shopOverlay.classList.add("hidden"),this.hud.classList.remove("hidden")}showShop(){this.hud.classList.add("hidden"),this.shopOverlay.classList.remove("hidden")}update(){if(this.game.state==="PLAYING"){this.goldDisplay.textContent=Math.floor(this.game.gold);const t=this.game.energy/this.game.maxEnergy*100;this.energyFill.style.width=`${Math.max(0,t)}%`}}}const L=[{id:"root",name:"Pirate Basics",description:"The start of your journey.",cost:0,x:270,y:40,effect:{},purchased:!0,parent:null},{id:"speed_1",name:"Peg Leg Polish",description:"+10% Movement Speed",cost:50,x:170,y:120,effect:{speed:25},purchased:!1,parent:"root"},{id:"damage_1",name:"Sharp Blade",description:"+25 Damage",cost:100,x:370,y:120,effect:{damage:25},purchased:!1,parent:"root"},{id:"cooldown_1",name:"Quick Hands",description:"-10% Swing Cooldown",cost:150,x:270,y:200,effect:{swingCooldown:-.1},purchased:!1,parent:"speed_1"},{id:"range_1",name:"Long Reach",description:"+20% Sword Range",cost:200,x:70,y:250,effect:{range:10},purchased:!1,parent:"speed_1"},{id:"arc_1",name:"Wild Swing",description:"Wider Swing Arc",cost:300,x:470,y:250,effect:{arc:30},purchased:!1,parent:"damage_1"},{id:"speed_attack_1",name:"Berserker",description:"+20% Atk Speed",cost:250,x:470,y:40,effect:{swingCooldown:-.2},purchased:!1,parent:"damage_1"},{id:"cannon_1",name:"Ship Support",description:"Auto-fire Cannons",cost:500,x:60,y:40,effect:{cannonLevel:1},purchased:!1,parent:"speed_1"},{id:"pet_1",name:"New Friend",description:"Unlock Carrot Pet",cost:400,x:270,y:280,effect:{petLevel:1},purchased:!1,parent:"cooldown_1"},{id:"pet_2",name:"Best Friend",description:"Evolve to Parrot",cost:1e3,x:270,y:360,effect:{petLevel:1},purchased:!1,parent:"pet_1"}];class C{constructor(t){this.game=t,this.nodes=JSON.parse(JSON.stringify(L)),this.container=document.getElementById("shop-items"),this.svgContainer=null}init(){if(console.log("SkillTree init called. Nodes:",this.nodes),!this.container){console.error("Shop container not found!");return}const t=document.getElementById("shop-gold-amount");t&&(t.innerText=this.game.gold),this.render()}render(){this.container.innerHTML="",this.svgContainer=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgContainer.style.position="absolute",this.svgContainer.style.top="0",this.svgContainer.style.left="0",this.svgContainer.style.width="100%",this.svgContainer.style.height="100%",this.svgContainer.style.pointerEvents="none",this.svgContainer.style.zIndex="0",this.container.appendChild(this.svgContainer),this.nodes.forEach(t=>{if(t.parent){const h=this.nodes.find(a=>a.id===t.parent);h&&this.drawLine(h.x,h.y,t.x,t.y,t.purchased)}const s=document.createElement("div");s.className=`skill-node ${t.purchased?"purchased":"locked"}`,s.style.left=`${t.x}px`,s.style.top=`${t.y}px`,s.setAttribute("data-desc",`${t.description}`);const e=this.nodes.find(h=>h.id===t.parent);!t.purchased&&(t.parent==="root"||e&&e.purchased)&&s.classList.add("available"),s.innerHTML=`
                <div class="name">${t.name}</div>
                <div class="cost">${t.cost}G</div>
            `,s.addEventListener("click",()=>this.buy(t)),this.container.appendChild(s)})}drawLine(t,s,e,i,h){const a=document.createElementNS("http://www.w3.org/2000/svg","line"),r=30;a.setAttribute("x1",t+r),a.setAttribute("y1",s+r),a.setAttribute("x2",e+r),a.setAttribute("y2",i+r),a.setAttribute("stroke",h?"#5d4037":"#ccc"),a.setAttribute("stroke-width","4"),a.setAttribute("stroke-dasharray",h?"none":"5,5"),this.svgContainer.appendChild(a)}buy(t){if(t.purchased)return;const s=this.nodes.find(e=>e.id===t.parent);if(!(t.parent!==null&&!s.purchased))if(this.game.gold>=t.cost){this.game.gold-=t.cost,t.purchased=!0,this.applyUpgrade(t.effect);const e=document.getElementById("shop-gold-amount");e&&(e.innerText=this.game.gold),this.render(),this.game.ui.update()}else{const e=document.querySelector(`.skill-node[style*="left: ${t.x}px"]`);e&&(e.classList.add("shake"),setTimeout(()=>e.classList.remove("shake"),500))}}applyUpgrade(t){const s=this.game.stats;t.speed&&(s.speed+=t.speed),t.damage&&(s.damage+=t.damage),t.swingCooldown&&(s.swingCooldown+=t.swingCooldown),t.range&&(s.range+=t.range),t.arc&&(s.arc+=t.arc),t.cannonLevel&&(s.cannonLevel+=t.cannonLevel),t.petLevel&&(s.petLevel+=t.petLevel)}}class R{constructor(t,s,e){this.game=t,this.x=s,this.y=e,this.width=40,this.height=40,this.type="Chest",this.markedForDeletion=!1,this.maxHp=150,this.hp=this.maxHp,this.invulnerable=!1,this.flashTimer=0,this.scaleY=1}takeDamage(t){this.hp-=t,this.flashTimer=.1,this.scaleY=.7,this.game.hitStop(.05),this.game.shake=5,c(async()=>{const{spawnParticles:s}=await import("./Particle-Bl0AywMg.js");return{spawnParticles:s}},[]).then(({spawnParticles:s})=>{s(this.game,this.x,this.y,"#8B4513",5,"splinter")}),this.hp<=0&&(this.markedForDeletion=!0,this.game.gold+=50,c(async()=>{const{spawnParticles:s}=await import("./Particle-Bl0AywMg.js");return{spawnParticles:s}},[]).then(({spawnParticles:s})=>{s(this.game,this.x,this.y,"#ffd700",20,"burst"),s(this.game,this.x,this.y,"#8B4513",10,"splinter")}),c(async()=>{const{FloatingText:s}=await Promise.resolve().then(()=>p);return{FloatingText:s}},void 0).then(({FloatingText:s})=>{this.game.texts.push(new s("+50G",this.x,this.y-30,"#ffd700",30))}))}update(t){this.flashTimer>0&&(this.flashTimer-=t),this.scaleY<1&&(this.scaleY+=t*5,this.scaleY>1&&(this.scaleY=1))}draw(t){const s=this.flashTimer>0?"#ffffff":null;f(t,this.game.assets.chest,this.x,this.y,this.width,this.height,0,1,this.scaleY,1,s),this.hp<this.maxHp&&u(t,this.x,this.y,this.width,this.hp,this.maxHp)}}class O{constructor(t,s,e){this.game=t,this.x=s,this.y=e,this.width=40,this.height=40,this.type="Rock",this.markedForDeletion=!1}update(t){}draw(t){f(t,this.game.assets.rock,this.x,this.y,this.width,this.height,0)}}class Y{constructor(t,s,e){this.game=t,this.x=s,this.y=e,this.width=40,this.height=40,this.type="Crab",this.markedForDeletion=!1,this.maxHp=100,this.hp=this.maxHp,this.speed=50,this.dirX=Math.random()>.5?1:-1,this.dirY=Math.random()>.5?1:-1,this.changeDirTimer=0,this.invulnerable=!1,this.flashTimer=0,this.scaleY=1}takeDamage(t){this.hp-=t,this.flashTimer=.1,this.scaleY=.8,this.game.hitStop(.05),this.game.shake=5,c(async()=>{const{spawnParticles:s}=await import("./Particle-Bl0AywMg.js");return{spawnParticles:s}},[]).then(({spawnParticles:s})=>{s(this.game,this.x,this.y,"#ff0000",5,"splinter")}),this.hp<=0&&(this.markedForDeletion=!0,c(async()=>{const{spawnParticles:s}=await import("./Particle-Bl0AywMg.js");return{spawnParticles:s}},[]).then(({spawnParticles:s})=>{s(this.game,this.x,this.y,"#ff0000",15,"burst")}))}update(t){this.changeDirTimer+=t,this.changeDirTimer>2&&(this.changeDirTimer=0,this.dirX=Math.random()>.5?1:-1,this.dirY=Math.random()>.5?1:-1),this.x+=this.dirX*this.speed*t,this.y+=this.dirY*this.speed*t,(this.x<0||this.x>this.game.canvas.width)&&(this.dirX*=-1),(this.y<0||this.y>this.game.canvas.height)&&(this.dirY*=-1);const s=this.game.player.x-this.x,e=this.game.player.y-this.y;Math.sqrt(s*s+e*e)<30&&(this.game.energy-=20*t),this.flashTimer>0&&(this.flashTimer-=t),this.scaleY<1&&(this.scaleY+=t*5,this.scaleY>1&&(this.scaleY=1))}draw(t){const s=this.flashTimer>0?"#ff0000":null,e=Math.atan2(this.dirY,this.dirX)-Math.PI/2;f(t,this.game.assets.crab,this.x,this.y,this.width,this.height,e,1,this.scaleY,1,s),u(t,this.x,this.y,this.width,this.hp,this.maxHp)}}class k{constructor(t,s,e,i="#fff",h=20){this.text=t,this.x=s,this.y=e,this.color=i,this.size=h,this.life=1,this.vy=-50,this.markedForDeletion=!1}update(t){this.y+=this.vy*t,this.life-=t,this.life<=0&&(this.markedForDeletion=!0)}draw(t){t.save(),t.globalAlpha=Math.max(0,this.life),t.fillStyle=this.color,t.font=`bold ${this.size}px monospace`,t.strokeStyle="#000",t.lineWidth=3,t.strokeText(this.text,this.x,this.y),t.fillText(this.text,this.x,this.y),t.restore()}}const p=Object.freeze(Object.defineProperty({__proto__:null,FloatingText:k},Symbol.toStringTag,{value:"Module"}));class F{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.resize(),window.addEventListener("resize",()=>this.resize()),this.input={keys:{},mouse:{x:0,y:0},rockHitCooldown:!1},this.setupInput(),this.state="START",this.lastTime=0,this.player=null,this.entities=[],this.particles=[],this.texts=[],this.gold=0,this.energy=30,this.maxEnergy=30,this.shake=0,this.stats={speed:250,damage:50,swingCooldown:.01,range:80,arc:0,cannonLevel:0,petLevel:0},this.energyDecayRate=1,this.ui=new I(this),this.skillTree=new C(this),this.assets={player:new Image,chest:new Image,rock:new Image,crab:new Image,sand:new Image},this.assetsLoaded=0,this.totalAssets=10,this.bgPattern=null,this.cannonTimer=0,this.hitStopDuration=0,this.loadAssets()}hitStop(t){this.hitStopDuration=t}loadAssets(){const t=(s,e)=>{const i=new Image;i.src=e,i.onload=()=>{s==="sand"?(this.assets[s]=i,this.assetsLoaded++,this.assetsLoaded===this.totalAssets&&console.log("All assets loaded")):c(async()=>{const{createTransparentSprite:h}=await Promise.resolve().then(()=>b);return{createTransparentSprite:h}},void 0).then(({createTransparentSprite:h})=>{this.assets[s]=h(i),this.assetsLoaded++,this.assetsLoaded===this.totalAssets&&console.log("All assets loaded & processed")})}};t("player","./sprites/player.png"),t("chest","./sprites/chest.png"),t("rock","./sprites/rock.png"),t("crab","./sprites/crab.png"),t("sand","./sprites/sand.png"),t("cannonball","./sprites/cannonball.png"),t("carrot","./sprites/carrot.png"),t("parrot","./sprites/parrot.png"),t("pirate","./sprites/pirate.png"),t("pistol","./sprites/pistol.png")}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}setupInput(){window.addEventListener("keydown",a=>{(a.code==="KeyW"||a.key==="w")&&(this.input.keys.w=!0),(a.code==="KeyA"||a.key==="a")&&(this.input.keys.a=!0),(a.code==="KeyS"||a.key==="s")&&(this.input.keys.s=!0),(a.code==="KeyD"||a.key==="d")&&(this.input.keys.d=!0),this.input.keys[a.key.toLowerCase()]=!0}),window.addEventListener("keyup",a=>{(a.code==="KeyW"||a.key==="w")&&(this.input.keys.w=!1),(a.code==="KeyA"||a.key==="a")&&(this.input.keys.a=!1),(a.code==="KeyS"||a.key==="s")&&(this.input.keys.s=!1),(a.code==="KeyD"||a.key==="d")&&(this.input.keys.d=!1),this.input.keys[a.key.toLowerCase()]=!1}),window.addEventListener("mousemove",a=>{const r=this.canvas.getBoundingClientRect();this.input.mouse.x=a.clientX-r.left,this.input.mouse.y=a.clientY-r.top}),window.addEventListener("mousedown",()=>{this.input.fire=!0}),window.addEventListener("mouseup",()=>{this.input.fire=!1});const t=()=>this.startGame("MOUSE"),s=()=>this.startGame("WASD"),e=document.getElementById("start-game-btn-mouse");e&&e.addEventListener("click",t);const i=document.getElementById("start-game-btn-wasd");i&&i.addEventListener("click",s);const h=document.getElementById("next-run-btn");h&&h.addEventListener("click",t)}startGame(t="MOUSE"){if(console.log("Starting Game... Mode:",t),this.controlMode=t,this.state="PLAYING",this.energy=this.maxEnergy,this.player=new D(this),this.entities=[],this.particles=[],this.texts=[],this.shake=0,this.stats.petLevel>0){const e=this.stats.petLevel===2?"parrot":"carrot";this.pet=new S(this,e)}else this.pet=null;const s=document.getElementById("rock-toggle");this.rocksEnabled=s?s.checked:!0,console.log(`Spawned ${this.entities.length} entities. Rocks Enabled: ${this.rocksEnabled}`);for(let e=0;e<15;e++)this.spawnEntity("chest");if(this.rocksEnabled)for(let e=0;e<15;e++)this.spawnEntity("rock");for(let e=0;e<10;e++)this.spawnEntity("crab");for(let e=0;e<5;e++)this.spawnEntity("pirate");console.log(`Spawned ${this.entities.length} entities.`),this.ui.showHUD()}start(){requestAnimationFrame(t=>this.loop(t))}loop(t){const s=(t-this.lastTime)/1e3;this.lastTime=t,this.update(s),this.draw(),requestAnimationFrame(e=>this.loop(e))}update(t){if(this.state==="PLAYING"){if(this.hitStopDuration>0){this.hitStopDuration-=t;return}if(this.energy-=this.energyDecayRate*t,this.energy<=0&&(this.energy=0,this.state="SHOP",this.gameOver()),this.shake>0&&(this.shake-=t*30,this.shake<0&&(this.shake=0)),this.player&&this.player.update(t),this.pet&&this.pet.update(t),this.entities.forEach(s=>s.update(t)),this.particles.forEach(s=>s.update(t)),this.texts.forEach(s=>s.update(t)),this.entities=this.entities.filter(s=>!s.markedForDeletion),this.particles=this.particles.filter(s=>!s.markedForDeletion),this.texts=this.texts.filter(s=>!s.markedForDeletion),this.stats.cannonLevel>0&&(this.cannonTimer+=t,this.cannonTimer>=5&&(this.cannonTimer=0,this.fireCannons())),this.entities.length<20){const s=Math.random();s<.3?this.spawnEntity("chest"):s<.7?this.spawnEntity("crab"):this.spawnEntity("pirate")}}}gameOver(){console.log("Game Over - Opening Shop"),this.ui.showShop(),this.skillTree.init()}draw(){if(this.ctx.save(),this.shake>0){const t=(Math.random()-.5)*this.shake,s=(Math.random()-.5)*this.shake;this.ctx.translate(t,s)}if(this.assets.sand&&this.assets.sand.complete&&this.assets.sand.naturalWidth!==0?(this.bgPattern||(this.bgPattern=this.ctx.createPattern(this.assets.sand,"repeat")),this.ctx.fillStyle=this.bgPattern,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)):(this.ctx.fillStyle="#e0cda7",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)),this.state==="PLAYING"){const t=[...this.entities];this.player&&t.push(this.player),this.pet&&t.push(this.pet),t.sort((s,e)=>s.y-e.y),t.forEach(s=>s.draw(this.ctx)),this.particles.forEach(s=>s.draw(this.ctx)),this.texts.forEach(s=>s.draw(this.ctx))}this.ctx.restore(),this.ui.update()}spawnEntity(t){const s=Math.random()*(this.canvas.width-100)+50,e=Math.random()*(this.canvas.height-100)+50;t==="chest"&&this.entities.push(new R(this,s,e)),t==="rock"&&this.entities.push(new O(this,s,e)),t==="crab"&&this.entities.push(new Y(this,s,e)),t==="pirate"&&this.entities.push(new M(this,s,e))}fireCannons(){const t=this.stats.cannonLevel*1;for(let s=0;s<t;s++){const e=this.player.x+(Math.random()-.5)*600,i=this.player.y+(Math.random()-.5)*600;setTimeout(()=>{this.entities.push(new A(this,e,i))},s*200)}this.texts.push(new k("CANNON BARRAGE!",this.player.x,this.player.y-100,"#ff4400",30))}}window.addEventListener("load",()=>{const n=document.getElementById("game-canvas");new F(n).start()});
