class m{constructor(t,a,r,h,s="splinter"){this.game=t,this.x=a,this.y=r,this.color=h,this.type=s,this.markedForDeletion=!1;const i=Math.random()*Math.PI*2;let e=Math.random()*100+50;this.vx=Math.cos(i)*e,this.vy=Math.sin(i)*e,this.gravity=0,this.friction=.95,s==="spark"?(this.vy=-Math.random()*100-50,this.gravity=500,this.life=.5,this.size=Math.random()*3+1):s==="splinter"?(this.gravity=0,this.life=1,this.size=Math.random()*4+2):s==="coin"?(this.state="POP",this.timer=0,this.vx=(Math.random()-.5)*300,this.vy=(Math.random()-.5)*300-200,this.gravity=800,this.life=10,this.size=8,this.friction=.9):s==="burst"?(this.life=.4,this.size=Math.random()*10+5,this.vx*=2,this.vy*=2):s==="dust"?(this.life=.5,this.size=Math.random()*8+4,this.vy=-20,this.vx*=.2,this.color="rgba(200, 200, 180, 0.5)"):(this.life=1,this.size=Math.random()*4+2),this.initialLife=this.life}update(t){this.type==="coin"?this.updateCoin(t):(this.x+=this.vx*t,this.y+=this.vy*t,this.vy+=this.gravity*t,this.vx*=this.friction,this.vy*=this.friction,this.life-=t,this.life<=0&&(this.markedForDeletion=!0))}updateCoin(t){if(this.state==="POP")this.x+=this.vx*t,this.y+=this.vy*t,this.vy+=this.gravity*t,this.y>this.game.player.y+100&&this.vy>0&&(this.vy*=-.6,this.vx*=.8),this.timer+=t,this.timer>.5&&(this.state="WAIT",this.timer=0);else if(this.state==="WAIT")this.timer+=t,this.timer>.2&&(this.state="FLY");else if(this.state==="FLY"){const h=40-this.x,s=40-this.y,i=Math.sqrt(h*h+s*s);if(i<30){this.markedForDeletion=!0;const l=this.value||1;this.game.addGold(l);return}const e=1500;this.x+=h/i*e*t,this.y+=s/i*e*t}}draw(t){if(t.save(),t.globalAlpha=Math.max(0,this.life/this.initialLife),this.type==="coin"&&(t.globalAlpha=1),this.game.assets.particles){const a=this.game.assets.particles,r=a.width/4,h=r,s=(a.height-h)/2;let i=0,e=!0,l=1;this.type==="coin"?(i=0,this.size=28,e=!1,l=Math.sin(this.game.lastTime*.005*10+this.x)):this.type==="blood"||this.type==="splinter"&&this.color==="#cc0000"?(i=1,this.size=20,e=!1):this.type==="smoke"||this.type==="dust"||this.type==="burst"&&this.color!=="#cc0000"?(i=2,this.size=30,e=!0):this.type==="splinter"?(i=3,this.size=22,e=!0):(i=0,l=.5);const n=this.x,y=this.y,f=this.size*Math.abs(l),c=this.size;t.translate(n,y),e&&t.rotate(this.game.lastTime*.005+n),t.drawImage(a,i*r,s,r,h,-f/2,-c/2,f,c)}else t.fillStyle=this.color,t.beginPath(),t.arc(this.x,this.y,this.size,0,Math.PI*2),t.fill();t.restore()}}function v(o,t,a,r,h,s){const i=[];for(let e=0;e<h;e++){const l=new m(o,t,a,r,s);o.particles.push(l),i.push(l)}return i}export{m as Particle,v as spawnParticles};
